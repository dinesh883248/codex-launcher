{{ define "livestream" }}
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Livestream</title>
<style>
{{ .CSS }}
</style>
<link rel="stylesheet" href="/static/asciinema-player.css?v={{ .CSSVersion }}"/>
<script src="/static/asciinema-player.min.js?v={{ .JSVersion }}"></script>
<script>
function startPlayer() {
  if (!window.AsciinemaPlayer) {
    return;
  }
  var target = document.querySelector("#player td");
  if (!target) {
    return;
  }
  var src = "{{ .CastURL }}";
  var opts = { autoPlay: true, autoplay: true, controls: false, preload: true, fit: "width" };
  if ({{ if .Streaming }}true{{ else }}false{{ end }}) {
    AsciinemaPlayer.create(
      { url: src, driver: "eventsource" },
      target,
      opts
    );
    return;
  }
  var player = AsciinemaPlayer.create(src, target, opts);
  if (!player || !player.getDuration || !player.seek) {
    return;
  }
  var tries = 0;
  function seekEnd() {
    var duration = player.getDuration();
    if (duration && duration > 0) {
      player.seek(Math.max(0, duration - 1));
      return;
    }
    tries += 1;
    if (tries < 20) {
      setTimeout(seekEnd, 300);
    }
  }
  setTimeout(seekEnd, 300);
}
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", startPlayer);
} else {
  startPlayer();
}
</script>
</head>
<body>
<table id="player" style="width: 380px;">
<colgroup>
<col style="width: 380px;"/>
</colgroup>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
</body>
</html>
{{ end }}
